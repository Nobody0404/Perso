#!/usr/bin/python
# -*- coding: ISO-8859-1 -*-


import sys, requests, re, os


SHODAN_API_KEY = '5tWpm2b9RZBuekbBlIIfYgVekVJ4j6lG'

for arg in sys.argv:
    if arg == "-s":
        search_term = sys.argv[2]

        exploitdb = "exploitdb.html"
        html = open(exploitdb, 'wb')
        page = requests.get("https://exploits.shodan.io/api/search?query="+search_term+"&key="+SHODAN_API_KEY)
        content = page.content
        html.write(content)
        html.close
        #command = "sed 's/\({\"code\)/\n\1/g'"
        os.system("sed 's/\({\"code\"\)/\\n\\1/g' exploitdb.html > test.html")
        regex = "grep -oP 'CVE-[^\"]*(?=\"])'"
        with open("test.html", 'r') as f:
            for line in f:
                exploitdb = re.search('ExploitDB', line)
                #if exploitdb:
                    #cve = re.findall('"cve": (?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\(\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+', line)
        os.system(regex+' test.html | sort -u')



        
