#!/bin/bash

#.  Description : Script to grab the banner and make a CVE search.

file="/root/Git/Python/scraper.py"
tmpfile="/tmp/tmp.txt"

usage(){

    scriptname=$(basename $0)
    echo -e "Available options: "
    echo -e "\t -t : Target IP"
    echo -e "\t -p : port list "
    echo ""
    echo "Example: ./$scriptname -t 127.0.0.1 -p 80"
}


while getopts "t:p:" opt; do
    case "${opt}" in
        t | target)
            target="${OPTARG}"
            ;;
        p | port)
            port="${OPTARG}"
            ;;
        *)  usage
            ;;
    esac

    nmap -p $port $target -sV > $tmpfile 2> /dev/null
    #echo $service
    cat $tmpfile | grep open | awk '{print $4"%20" $5}' | while read line
        do
            echo "############## SEARCH FOR $line ############"
            python $file -s $line
        done
done

if [ -z "${target}" ] || [ -z "${port}" ]; then
        usage
fi

if [ ! -f $file ]; then
    echo "$file doesn't exist. Living."
    exit 1
fi

exit 0
